import http from 'http'
import app from '../index'

const logger = require('../util/log')('app')

const port = normalizePort(process.env.PORT || '3000')

const server = http.createServer(app)

app.ready(server)

server.listen(port)
// server.on('error', onError)
// server.on('listening', onListening)

try {
  require('fs').mkdirSync('./logs')
} catch(e) {
  if (e.code != 'EEXIST') {
    console.error("Could not set up log directory, error was: ", e)
    process.exit(1)
  }
}

function normalizePort(val) {
  var port = parseInt(val, 10)

  if (isNaN(port)) {
    // named pipe
    return val
  }

  if (port >= 0) {
    // port number
    return port
  }

  return false
}

